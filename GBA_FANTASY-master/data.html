<html>
  <head>
    <title>Data</title>
    <link rel="stylesheet" href="css/main.css">
    <meta charset="UTF-8">
  </head>
  <body onload="addEventListeners(); newFunction();">

  <header>
    <h1>Gainesville Basketball Association Fantasy League</h1>
  </header>

  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <!-- <li><a href="login.html">Log-In</a></li> -->
      <li><a href="players.html">Add Players</a></li>
      <li><a href="stats.html">Add Statistics</a></li>
        <li><a href="data.html">Player Data</a></li>
      <li><a href="scoringTemplate.html">Scoring Template</a></li>
    </ul>
  </nav>

  <main>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <script src="p5.js" type="text/javascript"></script>
   
   <table>
  <tr>
    <th>Name</th>
    <th>Points</th> 
    <th>Rebounds</th>
	<th>Assists</th>
	<th>BM Points</th>
	<th>Fantasy Points</th>
  </tr>
  <tr>
    <td id = "A1" href = "">-</td>
    <td id = "B1">-</td> 
    <td id = "C1">-</td>
	<td id = "D1">-</td> 
    <td id = "E1">-</td>
	<td id = "F1">-</td> 
  </tr>
  <tr>
    <td id = "A2">-</td>
    <td id = "B2">-</td> 
    <td id = "C2">-</td>
	<td id = "D2">-</td> 
    <td id = "E2">-</td>
	<td id = "F2">-</td> 
  </tr>
  <tr>
    <td id = "A3">-</td>
    <td id = "B3">-</td> 
    <td id = "C3">-</td>
	<td id = "D3">-</td> 
    <td id = "E3">-</td>
	<td id = "F3">-</td> 
  </tr>
  <tr>
    <td id = "A4">-</td>
    <td id = "B4">-</td> 
    <td id = "C4">-</td>
	<td id = "D4">-</td> 
    <td id = "E4">-</td>
	<td id = "F4">-</td> 
  </tr>
  <tr>
    <td id = "A5">-</td>
    <td id = "B5">-</td> 
    <td id = "C5">-</td>
	<td id = "D5">-</td> 
    <td id = "E5">-</td>
	<td id = "F5">-</td> 
  </tr>
  <tr>
    <td id = "A6">-</td>
    <td id = "B6">-</td> 
    <td id = "C6">-</td>
	<td id = "D6">-</td> 
    <td id = "E6">-</td>
	<td id = "F6">-</td> 
  </tr>
  <tr>
    <td id = "A7">-</td>
    <td id = "B7">-</td> 
    <td id = "C7">-</td>
	<td id = "D7">-</td> 
    <td id = "E7">-</td>
	<td id = "F7">-</td> 
  </tr>
  <tr>
    <td id = "A8">-</td>
    <td id = "B8">-</td> 
    <td id = "C8">-</td>
	<td id = "D8">-</td> 
    <td id = "E8">-</td>
	<td id = "F8">-</td> 
  </tr>
  <tr>
    <td id = "A9">-</td>
    <td id = "B9">-</td> 
    <td id = "C9">-</td>
	<td id = "D9">-</td> 
    <td id = "E9">-</td>
	<td id = "F9">-</td> 
  </tr>
  <tr>
    <td id = "A10">-</td>
    <td id = "B10">-</td> 
    <td id = "C10">-</td>
	<td id = "D10">-</td> 
    <td id = "E10">-</td>
	<td id = "F10">-</td> 
  </tr>
  <tr>
    <td id = "A11">-</td>
    <td id = "B11">-</td> 
    <td id = "C11">-</td>
	<td id = "D11">-</td> 
    <td id = "E11">-</td>
	<td id = "F11">-</td> 
  </tr>
  <tr>
    <td id = "A12">-</td>
    <td id = "B12">-</td> 
    <td id = "C12">-</td>
	<td id = "D12">-</td> 
    <td id = "E12">-</td>
	<td id = "F12">-</td> 
  </tr>
   <tr>
        <td id = "A13">-</td>
        <td id = "B13">-</td>
        <td id = "C13">-</td>
        <td id = "D13">-</td>
        <td id = "E13">-</td>
        <td id = "F13">-</td>
    </tr>
	<tr>
        <td id = "A14">-</td>
        <td id = "B14">-</td>
        <td id = "C14">-</td>
        <td id = "D14">-</td>
        <td id = "E14">-</td>
        <td id = "F14">-</td>
    </tr>
	<tr>
        <td id = "A15">-</td>
        <td id = "B15">-</td>
        <td id = "C15">-</td>
        <td id = "D15">-</td>
        <td id = "E15">-</td>
        <td id = "F15">-</td>
    </tr>
	<tr>
        <td id = "A16">-</td>
        <td id = "B16">-</td>
        <td id = "C16">-</td>
        <td id = "D16">-</td>
        <td id = "E16">-</td>
        <td id = "F16">-</td>
    </tr>
	<tr>
        <td id = "A17">-</td>
        <td id = "B17">-</td>
        <td id = "C17">-</td>
        <td id = "D17">-</td>
        <td id = "E17">-</td>
        <td id = "F17">-</td>
    </tr>
	<tr>
        <td id = "A18">-</td>
        <td id = "B18">-</td>
        <td id = "C18">-</td>
        <td id = "D18">-</td>
        <td id = "E18">-</td>
        <td id = "F18">-</td>
    </tr><tr>
        <td id = "A19">-</td>
        <td id = "B19">-</td>
        <td id = "C19">-</td>
        <td id = "D19">-</td>
        <td id = "E19">-</td>
        <td id = "F19">-</td>
    </tr>
	<tr>
        <td id = "A20">-</td>
        <td id = "B20">-</td>
        <td id = "C20">-</td>
        <td id = "D20">-</td>
        <td id = "E20">-</td>
        <td id = "F20">-</td>
    </tr>
</table>

   <script type="text/javascript" language="javascript">
		const prefix = "https://spreadsheets.google.com/feeds/list/";
		const sheetId = "1Y4-AdSJEb1q8eRClrCRwYhaV8S2qL-k2p-iY1XSqUrI";
		const postFix = "/od6/public/values?alt=json";
		const spreadsheetUrl = prefix + sheetId + postFix;
		var arr = new Array();
		$.getJSON(spreadsheetUrl, function(data){
			console.log(data);
			var i;
			getPlayers();
			var x;
			console.log(arr);
			for (i = 0; i < arr.length; i++) {
				for(x = 1; x < arr[i].length; x ++){
					arr[i][x] = 0;
				}
			}
			for (i = 0; i < data.feed.entry.length; i++) {
				for(x = 0; x < arr.length; x ++){
					if(data.feed.entry[i].gsx$playername.$t == (arr[x][0])){
						console.log(arr[x][0]);
						arr[x][1] = Number(data.feed.entry[i].gsx$points.$t) + Number(arr[x][1]);
						arr[x][2] = Number(data.feed.entry[i].gsx$reb.$t) + Number(arr[x][2]);
						arr[x][3] = Number(data.feed.entry[i].gsx$ass.$t) + Number(arr[x][3]);
						arr[x][4] = Number(data.feed.entry[i].gsx$bm.$t) + Number(arr[x][4]);
						arr[x][5] = (arr[x][1] * 1) + (arr[x][2] * 2) + (arr[x][3] * 2) + (arr[x][4] * 2);
						arr[x][6] ++;
					}
				}
			}
			var max = -1;
			var prevmax = 10000;
			for(i = 1; i < arr.length + 1;){
				for(x = 0; x < arr.length; x ++){
					if((arr[x][5] / arr[x][6]) > max && (arr[x][5] / arr[x][6]) < prevmax){
						max = (arr[x][5] / arr[x][6]);
					}
				}
				for(x = 0; x < arr.length; x ++){
					if((arr[x][5] / arr[x][6]) == max){
						var profilePath = "playerProfiles/" + (arr[x][0].replace(", ", "")).toLowerCase() + ".html"
						document.getElementById("A" + i).innerHTML = '<a href="'+profilePath+'">'+arr[x][0]+'</a>';
						document.getElementById("B" + i).innerHTML = (arr[x][1] / arr[x][6]).toFixed(1) + "";
						document.getElementById("C" + i).innerHTML = (arr[x][2] / arr[x][6]).toFixed(1) + "";
						document.getElementById("D" + i).innerHTML = (arr[x][3] / arr[x][6]).toFixed(1) + "";
						document.getElementById("E" + i).innerHTML = (arr[x][4] / arr[x][6]).toFixed(1) + "";
						document.getElementById("F" + i).innerHTML = (arr[x][5] / arr[x][6]).toFixed(1) + "";
						i++;
					}
				}
				prevmax = max;
				max = -1;
			}
				
		});
		console.log(arr);
		function getPlayers(){
			const prefix = "https://spreadsheets.google.com/feeds/list/";
			const sheetId = "11bP0xYwyoobuC2oKWOJ5i2SUywXRiimsHG-xZX83m-g";
			const postFix = "/od6/public/values?alt=json";
			const spreadsheetUrl = prefix + sheetId + postFix;
			
			//$.getJSON(spreadsheetUrl, function(data){
			
			
			$.ajax({
			url: spreadsheetUrl,
			//data: "alt=json",
			type: 'GET',
			dataType: 'json',
			async: false,
			success: function (data) {
            console.log(data);
			var i;
			arr = new Array(data.feed.entry.length);
			for (var i = 0; i < arr.length; i++) {
				arr[i] = new Array(7);
			}
			for (i = 0; i < data.feed.entry.length; i++) { 
				arr[i][0] = data.feed.entry[i].gsx$lname.$t + ", " + data.feed.entry[i].gsx$fname.$t;
			}
			}
			});
			
			
			
		}
		function newFunction(){
			document.getElementById("A1").href = "google.com";
		}
	</script>
</main>
	</script>
</html>