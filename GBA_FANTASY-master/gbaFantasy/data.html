<html>
  <head>
    <title>Data</title>
    <link rel="stylesheet" href="css/main.css">
    <meta charset="UTF-8">
  </head>
  <body>

  <header>
    <h1>Gainesville Basketball Association Fantasy League</h1>
  </header>

  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <!-- <li><a href="login.html">Log-In</a></li> -->
      <li><a href="players.html">Add Players</a></li>
      <li><a href="stats.html">Add Statistics</a></li>
        <li><a href="data.html">Player Data</a></li>
      <li><a href="scoringTemplate.html">Scoring Template</a></li>
    </ul>
  </nav>

  <main>
    <!--
    BEFORE RUNNING:
    ---------------
    1. If not already done, enable the Google Sheets API
       and check the quota for your project at
       https://console.developers.google.com/apis/api/sheets
    2. Get access keys for your application. See
       https://developers.google.com/api-client-library/javascript/start/start-js#get-access-keys-for-your-application
    3. For additional information on authentication, see
       https://developers.google.com/sheets/api/quickstart/js#step_2_set_up_the_sample
    -->
	<!--
    <script>
    function makeApiCall() {
      var params = {
        // The ID of the spreadsheet to retrieve data from.
        spreadsheetId: '1Y4-AdSJEb1q8eRClrCRwYhaV8S2qL-k2p-iY1XSqUrI',  // TODO: Update placeholder value.

        // The A1 notation of the values to retrieve.
        range: 'Sheet1',  // TODO: Update placeholder value.

        // How values should be represented in the output.
        // The default render option is ValueRenderOption.FORMATTED_VALUE.
        //valueRenderOption: '',  // TODO: Update placeholder value.

        // How dates, times, and durations should be represented in the output.
        // This is ignored if value_render_option is
        // FORMATTED_VALUE.
        // The default dateTime render option is [DateTimeRenderOption.SERIAL_NUMBER].
        //dateTimeRenderOption: '',  // TODO: Update placeholder value.
      };

      var request = gapi.client.sheets.spreadsheets.values.get(params);
      request.then(function(response) {
        // TODO: Change code below to process the `response` object:
        console.log(response.result);
      }, function(reason) {
        console.error('error: ' + reason.result.error.message);
      });
    }

    function initClient() {
      var API_KEY = 'AIzaSyDwq2ZZJj3I2kBRBWzCRUxRkvQTzphBjZ0';  // TODO: Update placeholder with desired API key.

      var CLIENT_ID = '380741963099-rc344on9q1mrmh78b6bhm8h7l7fb0j7u.apps.googleusercontent.com';  // TODO: Update placeholder with desired client ID.

      // TODO: Authorize using one of the following scopes:
      //   'https://www.googleapis.com/auth/drive'
      //   'https://www.googleapis.com/auth/drive.file'
      //   'https://www.googleapis.com/auth/drive.readonly'
      //   'https://www.googleapis.com/auth/spreadsheets'
      //   'https://www.googleapis.com/auth/spreadsheets.readonly'
      var SCOPE = 'https://www.googleapis.com/auth/spreadsheets.readonly';

      gapi.client.init({
        'apiKey': API_KEY,
        'clientId': CLIENT_ID,
        'scope': SCOPE,
        'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
      }).then(function() {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
        updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      });
    }

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function updateSignInStatus(isSignedIn) {
      if (isSignedIn) {
        makeApiCall();
      }
    }

    function handleSignInClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    function handleSignOutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }
    </script>
    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <button id="signin-button" onclick="handleSignInClick()">Sign in</button>
    <button id="signout-button" onclick="handleSignOutClick()">Sign out</button>
  </body>
  -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <script src="p5.js" type="text/javascript"></script>
   <!--<p id = "p1">"getData()"</p>-->
   
   <table>
  <tr>
    <th>Name</th>
    <th>Points</th> 
    <th>Rebounds</th>
	<th>Assists</th>
	<th>BM Points</th>
	<th>Fantasy Points</th>
  </tr>
  <tr>
    <td id = "A1">-</td>
    <td id = "B1">-</td> 
    <td id = "C1">-</td>
	<td id = "D1">-</td> 
    <td id = "E1">-</td>
	<td id = "F1">-</td> 
  </tr>
  <tr>
    <td id = "A2">-</td>
    <td id = "B2">-</td> 
    <td id = "C2">-</td>
	<td id = "D2">-</td> 
    <td id = "E2">-</td>
	<td id = "F2">-</td> 
  </tr>
  <tr>
    <td id = "A3">-</td>
    <td id = "B3">-</td> 
    <td id = "C3">-</td>
	<td id = "D3">-</td> 
    <td id = "E3">-</td>
	<td id = "F3">-</td> 
  </tr>
  <tr>
    <td id = "A4">-</td>
    <td id = "B4">-</td> 
    <td id = "C4">-</td>
	<td id = "D4">-</td> 
    <td id = "E4">-</td>
	<td id = "F4">-</td> 
  </tr>
  <tr>
    <td id = "A5">-</td>
    <td id = "B5">-</td> 
    <td id = "C5">-</td>
	<td id = "D5">-</td> 
    <td id = "E5">-</td>
	<td id = "F5">-</td> 
  </tr>
  <tr>
    <td id = "A6">-</td>
    <td id = "B6">-</td> 
    <td id = "C6">-</td>
	<td id = "D6">-</td> 
    <td id = "E6">-</td>
	<td id = "F6">-</td> 
  </tr>
  <tr>
    <td id = "A7">-</td>
    <td id = "B7">-</td> 
    <td id = "C7">-</td>
	<td id = "D7">-</td> 
    <td id = "E7">-</td>
	<td id = "F7">-</td> 
  </tr>
  <tr>
    <td id = "A8">-</td>
    <td id = "B8">-</td> 
    <td id = "C8">-</td>
	<td id = "D8">-</td> 
    <td id = "E8">-</td>
	<td id = "F8">-</td> 
  </tr>
  <tr>
    <td id = "A9">-</td>
    <td id = "B9">-</td> 
    <td id = "C9">-</td>
	<td id = "D9">-</td> 
    <td id = "E9">-</td>
	<td id = "F9">-</td> 
  </tr>
  <tr>
    <td id = "A10">-</td>
    <td id = "B10">-</td> 
    <td id = "C10">-</td>
	<td id = "D10">-</td> 
    <td id = "E10">-</td>
	<td id = "F10">-</td> 
  </tr>
  <tr>
    <td id = "A11">-</td>
    <td id = "B11">-</td> 
    <td id = "C11">-</td>
	<td id = "D11">-</td> 
    <td id = "E11">-</td>
	<td id = "F11">-</td> 
  </tr>
  <tr>
    <td id = "A12">-</td>
    <td id = "B12">-</td> 
    <td id = "C12">-</td>
	<td id = "D12">-</td> 
    <td id = "E12">-</td>
	<td id = "F12">-</td> 
  </tr>

       <tr>
           <td id = "A13">-</td>
           <td id = "B13">-</td>
           <td id = "C13">-</td>
           <td id = "D13">-</td>
           <td id = "E13">-</td>
           <td id = "F13">-</td>
       </tr>
</table>
   
   <script type="text/javascript" language="javascript">
		const prefix = "https://spreadsheets.google.com/feeds/list/";
		const sheetId = "1Y4-AdSJEb1q8eRClrCRwYhaV8S2qL-k2p-iY1XSqUrI";
		const postFix = "/od6/public/values?alt=json";
		const spreadsheetUrl = prefix + sheetId + postFix;
		var arr = new Array();
		var good = "good";
		$.getJSON(spreadsheetUrl, function(data){
			console.log(data);
			var i;
			var text = "";
			for (i = 0; i < data.feed.entry.length; i++) { 
				text += data.feed.entry[i].gsx$playername.$t + " ";
				text += data.feed.entry[i].gsx$dateofgame.$t + " ";
				text += data.feed.entry[i].gsx$points.$t + " ";
				text += data.feed.entry[i].gsx$reb.$t + " ";
				text += data.feed.entry[i].gsx$ass.$t + " ";
				text += data.feed.entry[i].gsx$bm.$t + "\n";
			}
			console.log(text);
			//document.getElementById("p1").innerHTML = text;
			getPlayers();
			var x;
			console.log(arr);
			console.log(good);
			for (i = 0; i < arr.length; i++) {
				for(x = 1; x < arr[i].length; x ++){
					arr[i][x] = 0;
				}
			}
			for (i = 0; i < data.feed.entry.length; i++) {
				for(x = 0; x < arr.length; x ++){
					if(data.feed.entry[i].gsx$playername.$t == (arr[x][0])){
						arr[x][1] = Number(data.feed.entry[i].gsx$points.$t) + Number(arr[x][1]);
						arr[x][2] += Number(data.feed.entry[i].gsx$reb.$t) + Number(arr[x][2]);
						arr[x][3] += Number(data.feed.entry[i].gsx$ass.$t) + Number(arr[x][3]);
						arr[x][4] += Number(data.feed.entry[i].gsx$bm.$t) + Number(arr[x][4]);
						arr[x][5] = (arr[x][1] * 1) + (arr[x][2] * 2) + (arr[x][3] * 2) + (arr[x][4] * 2);
						arr[x][6] ++;
					}
				}
			}
			console.log(arr);
			var max = 0;
			for(i = 0; i < arr.length; i ++){
				if(Number(arr[i][5]) > max){
					max = arr[i][5];
				}
			}
			var tabarr = new Array(max + 1);
			for(i = 0; i < tabarr.length; i ++){
					tabarr[i] = 0;
			}
			for(i = max; i >= 0; i --){
				for(x = 0; x < arr.length; x++){
					if(Number(arr[x][5]) == i){
						tabarr[i]++;
					}
				}
			}
			var tablelength = arr.length;
			var points = max;
			for(i = 1; i < tablelength + 1;){
				for(x = 0; x < arr.length && tabarr[points] > 0; x ++){
					if(arr[x][5] == points){
						document.getElementById("A" + i).innerHTML = arr[x][0];
						document.getElementById("B" + i).innerHTML = arr[x][1] / arr[x][6] + "";
						document.getElementById("C" + i).innerHTML = arr[x][2] / arr[x][6] + "";
						document.getElementById("D" + i).innerHTML = arr[x][3] / arr[x][6] + "";
						document.getElementById("E" + i).innerHTML = arr[x][4] / arr[x][6] + "";
						document.getElementById("F" + i).innerHTML = arr[x][5] / arr[x][6] + "";
						i++;
						tabarr[points]--;
					}
				}
				points --;
			}
				
		});
		console.log(arr);
		function getPlayers(){
			const prefix = "https://spreadsheets.google.com/feeds/list/";
			const sheetId = "11bP0xYwyoobuC2oKWOJ5i2SUywXRiimsHG-xZX83m-g";
			const postFix = "/od6/public/values?alt=json";
			const spreadsheetUrl = prefix + sheetId + postFix;
			
			//$.getJSON(spreadsheetUrl, function(data){
			
			
			$.ajax({
			url: spreadsheetUrl,
			//data: "alt=json",
			type: 'GET',
			dataType: 'json',
			async: false,
			success: function (data) {
            console.log(data);
			var i;
			arr = new Array(data.feed.entry.length);
			for (var i = 0; i < arr.length; i++) {
				arr[i] = new Array(7);
			}
			for (i = 0; i < data.feed.entry.length; i++) { 
				arr[i][0] = data.feed.entry[i].gsx$lname.$t + ", " + data.feed.entry[i].gsx$fname.$t;
				//console.log(arr[i][0]);
			}
			//console.log(arr);
			//});
			}
			});
			
			
			
		}
	</script>

<!--
	<script>
		var x = 0;

var spaceData;

function setup() {
  createCanvas(200, 200);
  loadJSON("https://spreadsheets.google.com/feeds/list/1Y4-AdSJEb1q8eRClrCRwYhaV8S2qL-k2p-iY1XSqUrI/od6/public/values?alt=json", gotData, 'jsonp');
}

function gotData(data) {
  spaceData = data;
}

function draw() {
  background(0);
  
  if (spaceData) {
    randomSeed(4);
    for (var i = 0; i < spaceData.number; i++) {
      fill(255);
      ellipse(random(width), random(height), 16, 16);
    }
  }

  stroke(255);
  line(x, 0, x, height);
  x = x + 1;
  if (x > width) {
    x = 0;
  }
}
-->
</main>
  </body>
</html>